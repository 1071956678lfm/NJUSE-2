# Null And None电影院系统结构描述文档

# V1.0正式版

## 凉凉四人组

## 文档修改历史

| 修改人员 | 日期      | 修改原因 | 版本号 |
| :------: | --------- | -------- | ------ |
|  陆放明  | 2019-4-14 | 最初草稿 | V1.0.1   |
|  韩虚虹  | 2019-4-19 | 最初草稿新增用户界面层的分解 | V1.0.2  |

## 目录

<html>

<ol>
    <li>引言 </li>
        1.1 编制目的<br>
        1.2 词汇表<br>
        1.3 参考资料<br>
    <li>产品概述</li>
    <li>逻辑视角</li>
    <li>组合视角</li>
        4.1 开发包图<br>
        4.2 运行时进城<br>
        4.3 物理部署<br>
    <li>接口视角</li>
        5.1 模块的职责<br>
        5.2 用户界面层的分解<br>
        		<ol>
            5.2.1 数据层模块的职责<br>
            5.2.2 数据层模块的接口规范<br>
            </ol>
        5.4 接口控制层的分解<br>
    		    		<ol>
            5.4.1 数据层模块的职责<br>
            5.4.2 数据层模块的接口规范<br>
            </ol>
    	5.5 业务逻辑层的分解<br>
    		    		<ol>
            5.5.1 数据层模块的职责<br>
            5.5.2 数据层模块的接口规范<br>
            </ol>
        5.6 数据访问层的分解<br>
     		<ol>
            5.6.1 数据层模块的职责<br>
            5.6.2 数据层模块的接口规范<br>
            </ol>
    	5.7 数据层的分解
            <ol>
            5.7.1 数据层模块的职责<br>
            5.7.2 数据层模块的接口规范<br>
            </ol>
    <li>信息视角</li>
        6.1 数据持久化对象<br>
        6.2 序列化持久化格式<br>
        6.3 数据库表<br>
</ol>

</html>

## 1.引言

### 1.1编制目的

本报告详细完成对电影院系统的概要设计，达到指导详细设计和开发的目的，同时实现测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户编写，是了解系统的导航。

### 词汇表

|    词汇名称     | 词汇含义   | 备注               |
| :-------------: | ---------- | ------------------ |
|    audience     | 观众       |                    |
|     manager     | 经理       |                    |
|     account     | 账户       | 个人电影账户       |
|     signUp      | 注册       |                    |
|      login      | 登陆       |                    |
|       UI        | 界面       |                    |
|       BL        | 逻辑       |                    |
|       DAO       | 数据访问   | 对于数据的增删改查 |
| dataPersistence | 数据持久层 | 数据库数据         |
|     service     | 业务逻辑层 | 具体用例实现       |
|   controller    | 接口控制层 | 客户端交互实现     |



### 1.3 参考资料

1. Null And None电影院系统用例文档 V1.0
2. Null And None电影院系统需求规格说明文档 V1.0
3. 丁二玉，刘钦.计算与软件工程（卷二）[M]机械工业出版2012：134—182
4. IEEE std 1471-2000

## 2. 产品概述

参考《Null And None电影院系统》和《Null And None电影院系统需求规格说明文档》中对产品的描述。

## 3. 逻辑视图

- 处理静态设计模型

Null And None电影院系统中，选择了RestFul分层体系结构的风格，

将系统分为4层

- `UI展示层、接口控制层、业务逻辑层、数据访问层(DAO)、数据持久层`

- 能够很好的示意整个高层抽象。

- **UI展示层**包括UI页面的实现

- **接口控制层**包含服务器与客户端接口交互的实现

- **业务逻辑层**包含具体用例逻辑实现

- **数据访问层(DAO)**负责数据的访问

- **数据持久层**负责MySql数据到JAVA实体类的映射

  注：

  - 系统将VO层分解为接口控制层与业务逻辑层的共同职责
  - PO层分解为业务逻辑层与数据访问层的共同职责

  分层架构转换如下图：

  

  

  分层体系结构的逻辑视角和逻辑设计方案如图1和图2所示。

图1：分层结构（逻辑视角）

![](<https://github.com/1071956678lfm/NJUSE-2/blob/master/%E6%96%87%E6%A1%A3/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E9%80%BB%E8%BE%91%E8%A7%86%E8%A7%92.png?raw=true>)



图2：逻辑设计方案

- 示意图

  

  

## 4. 组合视图

### 4.1 开发包图

[软工2 166]与抽象的逻辑设计相比，实现物理设计要考虑更多的实现细节，这些细节有：<br>
1）所有的presentation层开发包都需要使用图形类型建立界面，都要依赖于图形界面类库包。<br>
2）在presentation层实现时，由mainUI包负责不同参与者在整个页面之间的跳转逻辑。其他各包负责各自页面自身的功能，并由各自的controller负责自身内部页面之间的跳转逻辑。<br>
3）presentation层被置于客户端，`接口控制层`、`业务逻辑层`、`数据访问层`和`数据持久层`被置于服务器端，那么presentation层的开发包不可能依赖于接口控制层的开发包。使用RMI技术，将后端架构层开发包分解为置于客户端的businessLogicService接口包和置于服务器端的业务逻辑层开发包。这样一来，presentation层开发包依赖于businessLogicService包，businessLogicService包依赖于RMI类库包。<br>
4）所有的数据访问层开发包都需要进行数据持久化（例如读写数据库、读写序列化文件等），所以它们会有一些重复代码，可以将重复代码独立为新的开发包，依赖JPA持久层框架，通过sql语句映射至JAVA语句，实现数据库数据的操作。<br>
5）在分层风格的典型设计中，不希望高层直接依赖于低层，而是为低层建立接口包，实现依赖倒置原则，所以应该调整为：各presentation层开发包（调用）依赖于logic层接口包businessLogicService包，businessLogic层开发包也依赖于（实现了）businessLogic层接口包businessLogicService包。<br>
6）在分层风格的典型设计中，presentation层与业务逻辑层之间、业务逻辑层与数据访问层之间可能会传递复杂数据对象，那么相邻两层都需要使用数据对象声明
7）使用依赖倒置原则消除包的循环依赖现象，将循环依赖变为单向依赖：<br>
<br>

8）在业务逻辑层中，初始化和业务逻辑层上下文的工作被分配到utility包中。<br>

界面层依据参与者分为main、登录界面和4个参与者主界面；逻辑层主要依据逻辑分包的结果，并添加logInBL，负责用户的登录和客户的注册；数据层进行整合合并，依照参与者、电影院账单、账的实际情况进行分类。<br>

|     开发包     | 依赖的其他开发包                                |
| :------------: | ----------------------------------------------- |
|     mainui     | userui、manageui、vo、clientui                  |
|    loginUI     | loginBLService,界面类库包,VO                    |
| stockManagerUI | loginBLService,commodityBLService,界面类库包,VO |
| loginBLService | Java RMI,VO                                     |
|                |                                                 |
|                |                                                 |



图3：客户端开发包图





图4：服务器端开发包图







### 4.2 运行时进程

- 在Null And None电影院系统中，会有多个客户端进程和一个服务器端进程，其进程图如下图所示。结合部署图，客户端进程是在客户端机器上运行，服务器端进程是在服务器端机器上运行。


图5：进程图

![图5进程图](http://101.37.19.32:10080/161250181/ERPnju/raw/master/doc/md/体系结构描述文档图/进程图.png)

### 4.3 物理部署

- 在Null And None电影院系统中客户端构件是放在客户端机上，服务器端构件是放在服务器端机器上。在客户端节点上，还要部署RMIStub构件。由于Java RMI 构件属于JDK1.8的一部分。所以，在系统JDK环境已经设置好的情况下，不需要独立部署。部署图如下图所示。

- 处理如何将软件组件映射到硬件基础设施

图6：部署图

![图6部署图](http://101.37.19.32:10080/161250181/ERPnju/raw/master/doc/md/体系结构描述文档图/部署图.png)

## 5. 架构设计

- 描述功能分解和如何在不同的层中安排软件模块
  - 描述架构中的对象，包含架构图
  - 描述组件接口信息
    - 包括：语法、前置条件、后置条件

### 5.1 模块职责

- 模块视图

客户端模块和服务器模块视图分别如图7和图8所示。

图7：客户端模块视图

![图7客户端模块视图](http://101.37.19.32:10080/161250181/ERPnju/raw/master/doc/md/体系结构描述文档图/客户端模块视图.png)

图8：服务端模块视图

![](<https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A8%A1%E5%9D%97%E8%A7%86%E5%9B%BE.png>)

**客户端各层的职责**

| 层             | 职责                                         |
| -------------- | -------------------------------------------- |
| 启动模块       | 负责初始化网络通信机制，启动用户界面         |
| 用户界面层     | 基于窗口的灯具公司进销存系统用户界面         |
| 业务逻辑层     | 对于用户界面的输入进行相应并进行业务处理逻辑 |
| 客户端网络模块 | 利用Java RMI机制查找RMI服务                  |

**服务器端各层的职责**

| 层         | 职责                               |
| ---------- | ---------------------------------- |
| 接口控制层 | 负责与客户端进行HTTP交互           |
| 业务逻辑层 | 负责用例复杂逻辑实现               |
| 数据访问层 | 负责处理数据的持久化及数据访问接口 |
| 数据持久层 | 负责数据库数据的映射               |

每一层只是使用下方直接接触的层。层与层之间仅仅是通过接口的调用来完成的。层之间调用的接口如下表所示。

- 层之间调用接口

| 接口                                                         | 服务调用方         | 服务提供方         |
| ------------------------------------------------------------ | ------------------ | ------------------ |
| loginBLService<br>commodityBLService<br>customerBLService<br>mainfestBLService<br>bankaccountBLService<br>reciptBLService<br>recordBLService<br>accountBLService<br>checkBLService<br>promotionBLService<br>userBLService<br> | 客户端展示层       | 服务器端业务逻辑层 |
| commodityDataService<br> customerDataService<br> mainfestDataService<br> bankaccountDataService<br> reciptDataService<br> recordDataService<br> accountDataService<br> checkDataService<br> promotionDataService<br> userDataService<br> | 服务器端业务逻辑层 | 服务器端数据层     |

每一层之间都是由上层依赖了一个接口（需接口），而下层实现这个接口（供接口）。

### 5.2 用户界面层分解
根据需求，系统存在28个用户界面：登陆界面、注册界面、用户首页界面、用户影库界面、快速购票界面、电影详情界面、观众选座购票界面、观众帮助界面、观众购买会员卡界面、观众查看会员卡消费记录、余额、充值界面、观众查看会员卡相关信息界面（级别、优惠）、观众个人中心主界面（基本信息）、观众更改基本信息界面、观众历史订单界面、退改票界面、观众查看优惠券会员卡界面、观众查看已标记喜爱电影界面、观众消息界面、管理员首页界面、管理员管理状态主界面（上架电影）、管理员管理排片界面、管理员发布优惠信息界面、数据统计界面、搜索结果界面、经理修改会员卡优惠界面、经理修改退票策略界面、经理影厅信息录入修改界面、经理修改影院角色界面、界面跳转如图9所示。

图9 用户界面跳转

- 类图

用户界面类如图10所示。

图10 用户界面类

#### 5.2.1 用户界面层模块的职责
模块 | 职责
---|---
MainFrame | 界面Frame，负责界面的显示和界面的跳转
LoginFrame | 界面Frame，负责登录界面的显示和观众/管理员/经理首页界面的跳转
RegisterFrame | 界面Frame，负责注册界面的显示和登录界面的跳转
UserUI.RefundFrame | 界面frame，负责观众退票界面的显示和跳转
UserUI.MainFrame | 界面Frame，负责观众主界面的跳转和观众的首页界面的显示
UserUI.MovieDatabaseFrame | 界面Frame，负责电影详情界面的跳转和影库信息的显示
UserUI.FastBookingFrame | 界面Frame，负责观众购票界面的跳转和观众快速购票的显示
UserUI.HelperFrame | 界面Frame，负责观众帮助导航的跳转和观众帮助的显示
UserUI.BuyVIPcardFrame | 界面Frame，负责观众付款界面的跳转和观众会员卡购买的显示
UserUI.CheckVIPcardFrame | 界面Frame，负责观众会员卡导航的跳转和观众查看会员卡相关信息页面的显示
UserUI.VIPcardCostFrame | 界面Frame，负责观众付款界面的跳转和观众会员卡购买的显示
UserUI.HomeFrame | 界面Frame，负责观众导航的跳转和观众个人中心首页的显示
UserUI.ChangeInformationFrame | 界面Frame，负责观众个人中心导航的跳转和观众修改个人信息界面的显示
UserUI.HistoryFrame | 界面Frame，负责观众个人中心导航界面的跳转和观众历史订单的显示
UserUI.CheckDiscountFrame | 界面Frame，负责观众个人中心导航界面的跳转和观众普通优惠信息的显示
UserUI.CheckMarkFrame | 界面Frame，负责观众电影详情的跳转和观众标记电影列表的显示
UserUI.MessageFrame | 界面Frame，负责观众消息界面的显示
AdministerUI.PutawayFrame|界面frame，负责管理人员管理电影排
片界面的显示和跳转
SelectFrame|界面frame，负责搜索结果到显示和影片详细信息到跳转
AdministerUI.MainFrame | 界面Frame，负责管理人员主界面的跳转和管理人员的首页界面的显示
AdministerUI.HomeFrame | 界面Frame，负责导航的跳转和管理人员的主界面的显示
AdministerUI.ScheduleFrame | 界面Frame，负责导航的跳转和管理人员管理电影排片界面的显示
AdministerUI.DiscountFrame | 界面Frame，负责导航的跳转和管理人员发布优惠信息的显示
AdministerUI.StatisticFrame | 界面Frame，负责导航的跳转和统计数据的显示
ManagerUI.MainFrame | 界面Frame，负责经理主界面的跳转和经理的首页界面的显示
ManagerUI.HomeFrame | 界面Frame，负责经理导航的跳转和经理的主界面的显示
ManagerUI.DiscountFrame | 界面Frame，负责导航的跳转和经理修改会员优惠策略界面的显示
ManagerUI.RefundFrame | 界面Frame，负责导航的跳转和经理修改观众退改票策略界面的显示
ManagerUI.MovieHallFrame | 界面Frame，负责导航的跳转和经理管理影厅信息界面的显示
ManagerUI.RoleFrame | 界面Frame，负责导航的跳转和经理修改影院角色界面的显示

- 接口规范
- 需要的服务接口

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| blservice.loginservice | 登录界面的业务逻辑接口 |



#### 5.2.2 接口规范

| 接口名 | 语法         |
| ------ | :----------- |
|        | **前置条件** |
|        | **后置条件** |

### 5.3 接口控制层分解

#### 5.3.1 职责



#### 5.3.2 接口规范



### 5.4 业务逻辑层分解

#### 5.4.1 职责

##### 5.4.1.1 具体职能

接受接口控制层的请求，处理复杂的用例事件，来完成上层的行为；

同时将用例事件细化到数据持久化层的操作，指派下层任务

##### 5.4.1.2 业务逻辑层的设计



##### 5.4.1.3 业务逻辑层的模块的职责

| 模块                | 职责                                       |
| ------------------- | ------------------------------------------ |
| UserInfoService     | 负责用户信息管理所需要的服务               |
| UserService         | 负责用户登陆、注册、登出操作所需要的服务   |
| MovieService        | 负责电影信息管理、电影信息检索所需要的服务 |
| MemberService       | 负责会员信息管理所需要的服务               |
| FavorService        | 负责管理想看电影所需要的服务               |
| MovieArrangeService | 负责排片用例所需要的服务                   |
| MovieSumService     | 负责电影信息统计的服务                     |
| HallService         | 负责电影院信息管理的服务                   |
| TicketService       | 负责电影票管理的服务                       |
| RoleService         | 负责用户角色信息管理的服务                 |
| PermissionService   | 负责角色权限管理的服务                     |
| PreferentialService | 负责优惠                                   |



#### 5.4.2 接口规范
<html>
    <!--用例描述模板-->

<table>
    	<tr>
            <th colspan="3">提供的服务（供接口）</td>
        </tr>
        <tr>
          <th rowspan="3">UserService.login</th>
          <td>语法</td>
          <td>public JSONObject login(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>用户进入网页，并且用户账户存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>系统跳转到对应网页主界面</td>
        </tr>
</table>

<table>
        <tr>
          <th rowspan="3">UserService.login</th>
          <td>语法</td>
          <td>public JSONObject login(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>用户进入网页，并且用户账户存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>系统跳转到对应网页主界面</td>
        </tr>
</table>

</html>


### 5.5 数据访问层分解

#### 5.5.1 职责

#### 5.5.2 接口规范



### 5.6 数据层持久分解

#### 5.6.1 职责

#### 5.6.2 接口规范



## 6. 信息视角

- 描述数据持久化对象(PO)
  - 属性及其定义
  - 类型
